## Задание ПРО по теме 1.3 «Введение в Docker»‎

Данный учебный проект использует 2 Docker-контейнера для:
* создания и инициализации БД PostgreSQL, и
* запуска python-скрипта, выполняющего SQL-запрос и обрабатывающего его результаты.

Для описания контейнеров используется файл `docker-compose.yaml`, который также ссылается на файл `dockerfile` в части, относящейся к python.

В `docker-compose.yaml` используется именованный том `vol-1-3-pro` для хранения БД со всеми изменениями даже в случае удаления контейнера или образа.

В контейнер postgres монтируется локальная папка `pg_initdb`, содержащая SQL-скрипт для инициализации БД, а в контейнер python монтируется локальная папка `py_app`, содержащая python-скрипт `app.py`. Папка `py_app` также содержит файл `requirements.txt`, но он копируется в контейнер при создании образа командой `COPY` файла `dockerfile`. Таким образом, скрипты `init.sql` и `app.py` можно редактировать без пересборки контейнера. Однако, если меняется файл `requirements.txt`, потребуется пересборка.

В описание контейнера python понадобилось добавить следующий фрагмент:

```
   depends_on:
      db:
        condition: service_healthy
```

Без него при первоначальном запуске проекта появляется ошибка:

![](/readme_images/1-error.png)

говорящая о неготовности сервера postgres. Эта ошибка не устранялась просто указанием на зависимость от `db` или указанием на зависимость с тегом `service_started`. Соответственно, в описание контейнера postgres добавлен раздел `healthcheck`.

Проект запускается командой `docker-compose up -d` из папки, содержащей `docker-compose.yaml`:

![](/readme_images/2-startup.png)

Контейнеры появляются в Docker Desktop, при этом контейнер python после обработки скрипта переходит в статус Exited:

![](/readme_images/3-status.png)

Результаты работы скрипта можно посмотреть в журнале контейнера:

![](/readme_images/4-logs.png)

В не-ПРО части задания также предлагается написать специальную команду docker, которая позволит подключаться к работающему контейнеру, запускать интерфейс psql и вносить новые данные «на лету». В качестве такой команды можно использовать
```
docker exec -it pg-1-3-pro psql -U postgres -d testdb
```
![](/readme_images/5-psql.png)
